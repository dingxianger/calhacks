"use strict";var e=require("react"),t=require("../../utils/use-force-update.cjs"),r=require("../../utils/use-is-mounted.cjs"),n=require("./PresenceChild.cjs"),c=require("../../context/LayoutGroupContext.cjs"),s=require("../../utils/use-isomorphic-effect.cjs"),i=require("../../utils/use-unmount-effect.cjs"),u=require("../../utils/errors.cjs");function o(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=o(e);const l=e=>e.key||"";exports.AnimatePresence=({children:o,custom:f,initial:d=!0,onExitComplete:m,exitBeforeEnter:p,presenceAffectsLayout:h=!0,mode:E="sync"})=>{u.invariant(!p,"Replace exitBeforeEnter with mode='wait'");const y=e.useContext(c.LayoutGroupContext).forceRender||t.useForceUpdate()[0],x=r.useIsMounted(),j=function(t){const r=[];return e.Children.forEach(t,(t=>{e.isValidElement(t)&&r.push(t)})),r}(o);let w=j;const P=e.useRef(new Map).current,v=e.useRef(w),C=e.useRef(new Map).current,O=e.useRef(!0);if(s.useIsomorphicLayoutEffect((()=>{O.current=!1,function(e,t){e.forEach((e=>{const r=l(e);t.set(r,e)}))}(j,C),v.current=w})),i.useUnmountEffect((()=>{O.current=!0,C.clear(),P.clear()})),O.current)return a.createElement(a.Fragment,null,w.map((e=>a.createElement(n.PresenceChild,{key:l(e),isPresent:!0,initial:!!d&&void 0,presenceAffectsLayout:h,mode:E},e))));w=[...w];const g=v.current.map(l),b=j.map(l),q=g.length;for(let e=0;e<q;e++){const t=g[e];-1!==b.indexOf(t)||P.has(t)||P.set(t,void 0)}return"wait"===E&&P.size&&(w=[]),P.forEach(((e,t)=>{if(-1!==b.indexOf(t))return;const r=C.get(t);if(!r)return;const c=g.indexOf(t);let s=e;if(!s){const e=()=>{C.delete(t),P.delete(t);const e=v.current.findIndex((e=>e.key===t));if(v.current.splice(e,1),!P.size){if(v.current=j,!1===x.current)return;y(),m&&m()}};s=a.createElement(n.PresenceChild,{key:l(r),isPresent:!1,onExitComplete:e,custom:f,presenceAffectsLayout:h,mode:E},r),P.set(t,s)}w.splice(c,0,s)})),w=w.map((e=>{const t=e.key;return P.has(t)?e:a.createElement(n.PresenceChild,{key:l(e),isPresent:!0,presenceAffectsLayout:h,mode:E},e)})),"production"!==process.env.NODE_ENV&&"wait"===E&&w.length>1&&console.warn('You\'re attempting to animate multiple children within AnimatePresence, but its mode is set to "wait". This will lead to odd visual behaviour.'),a.createElement(a.Fragment,null,P.size?w:w.map((t=>e.cloneElement(t))))};
