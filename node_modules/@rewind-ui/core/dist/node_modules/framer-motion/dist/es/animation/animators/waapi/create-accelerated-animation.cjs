"use strict";var e=require("../../../frameloop/index.cjs"),t=require("./index.cjs"),a=require("./easing.cjs"),r=require("./supports.cjs"),i=require("./utils/get-final-keyframe.cjs"),n=require("../js/index.cjs"),s=require("../../../utils/time-conversion.cjs");const o=new Set(["opacity","clipPath","filter","transform","backgroundColor"]);exports.createAcceleratedAnimation=function(l,c,{onUpdate:u,onComplete:p,...m}){if(!(r.supports.waapi()&&o.has(c)&&!m.repeatDelay&&"mirror"!==m.repeatType&&0!==m.damping&&"inertia"!==m.type))return!1;let d,y,f=!1;const g=()=>{y=new Promise((e=>{d=e}))};g();let{keyframes:h,duration:j=300,ease:q,times:v}=m;if(((e,t)=>"spring"===t.type||"backgroundColor"===e||!a.isWaapiSupportedEasing(t.ease))(c,m)){const e=n.animateValue({...m,repeat:0,delay:0});let t={done:!1,value:h[0]};const a=[];let r=0;for(;!t.done&&r<2e4;)t=e.sample(r),a.push(t.value),r+=10;v=void 0,h=a,j=r-10,q="linear"}const T=t.animateStyle(l.owner.current,c,h,{...m,duration:j,ease:q,times:v}),k=()=>T.cancel(),S=()=>{e.frame.update(k),d(),g()};return T.onfinish=()=>{l.set(i.getFinalKeyframe(h,m)),p&&p(),S()},{then:(e,t)=>y.then(e,t),get time(){return s.millisecondsToSeconds(T.currentTime||0)},set time(e){T.currentTime=s.secondsToMilliseconds(e)},get speed(){return T.playbackRate},set speed(e){T.playbackRate=e},get duration(){return s.millisecondsToSeconds(j)},play:()=>{f||(T.play(),e.cancelFrame(k))},pause:()=>T.pause(),stop:()=>{if(f=!0,"idle"===T.playState)return;const{currentTime:e}=T;if(e){const t=n.animateValue({...m,autoplay:!1});l.setWithVelocity(t.sample(e-10).value,t.sample(e).value,10)}S()},complete:()=>T.finish(),cancel:S}};
