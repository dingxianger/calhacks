'use client';
"use strict";var e=require("tslib"),s=require("react/jsx-runtime"),o=require("./ComboboxGroup/ComboboxGroup.cjs"),t=require("./ComboboxOption/ComboboxOption.cjs"),r=require("./use-combobox.hook.cjs"),a=require("../FormControl/FormControl.context.cjs"),n=require("../InputGroup/InputGroup.context.cjs"),i=require("../Spinner/Spinner.cjs"),l=require("@floating-ui/react"),c=require("../../hooks/use-keypress.cjs"),u=require("../../hooks/use-vertical-arrows.hook.cjs"),d=require("../../icons/XMark.cjs"),h=require("../../theme/theme.context.cjs"),p=require("../../utils/usePropId.cjs"),b=require("react"),m=require("./Combobox.context.cjs"),f=require("../../icons/CaretUpDown.cjs");const g={clearable:!0,closeOnEscape:!0,color:"dark",disabled:!1,loading:!1,maxHeight:250,minWidth:250,mode:"spacey",offset:5,optionColor:"gray",radius:"md",searchable:!0,shadow:"none",size:"md",tone:"light",validation:"none",withRing:!0},x=b.forwardRef(((o,t)=>{const x=h.useComponentTheme("Combobox"),j=Object.assign(Object.assign(Object.assign(Object.assign({},g),a.useFormControlContext()),n.useInputGroupContext()),o),{children:C,className:v,clearable:O,closeOnEscape:y,color:q,controlId:w,initialValue:E,leftIcon:N,loading:S,maxHeight:I,minWidth:R,mode:k,offset:z,onChange:P,onSearch:G,optionColor:W,placeholder:L,radius:F,searchable:H,shadow:V,size:M,tone:A,validation:$,value:B,withRing:D}=j,K=e.__rest(j,["children","className","clearable","closeOnEscape","color","controlId","initialValue","leftIcon","loading","maxHeight","minWidth","mode","offset","onChange","onSearch","optionColor","placeholder","radius","searchable","shadow","size","tone","validation","value","withRing"]),T=p.usePropId(o.id),U=b.useId(),X=p.usePropId(w),_=o.disabled||S,J=!!N,[Q,Y]=b.useState(""),[Z,ee]=b.useState(!1),[se,oe]=b.useState(E),[te,re]=b.useState(""),[ae,ne]=b.useState([]),[ie,le]=b.useState(""),[ce,ue]=b.useState(""),[de,he]=b.useState(null),pe=b.useRef(!0),be=b.useRef(null),me=b.useRef(null),fe=b.useRef(null),ge={externalSearch:!!G,mode:k,optionColor:W,radius:F,search:Q,selectedLabel:te,selectedValue:se,setSearch:Y,setSelectedLabel:re,setSelectedValue:oe,size:M},{x:xe,y:je,reference:Ce,floating:ve,strategy:Oe,getFloatingProps:ye,open:qe,setOpen:we}=r.useCombobox({offset:z}),Ee=l.useMergeRefs([Ce,be,t||null]),Ne=l.useMergeRefs([me,ve]),Se=x.wrapper({disabled:_}),Ie=x.noResults({size:M}),Re=N?x.icon({tone:A,size:M,className:N.props.className}):null,ke=x.leftIconWrapper({size:M}),ze=x.icon({tone:A,size:M}),Pe=x.rightIconWrapper({size:M});b.useEffect((()=>{be.current&&he(be.current.getBoundingClientRect().width)}),[]),b.useEffect((()=>{Y(""),ee(!1)}),[te]),b.useEffect((()=>{P&&!pe.current&&P(se),pe.current=!1}),[se]),b.useEffect((()=>{oe(B)}),[B]),b.useEffect((()=>{var e;qe&&(null===(e=fe.current)||void 0===e||e.focus()),Le()}),[qe]),c.useKeypress("Escape",!0,(()=>{Y(""),ee(!1),qe&&y&&we(!1)})),c.useKeypress("Enter",!0,(()=>{var e;if(!Z)return;const s=null===(e=me.current)||void 0===e?void 0:e.querySelector('button[aria-hidden="false"]:not([aria-disabled="true"])');s&&s.click()})),b.useLayoutEffect((()=>{setTimeout((()=>{me.current&&ne(Array.from(me.current.querySelectorAll('button[aria-hidden="false"][aria-disabled="false"]')))}),1),Le()}),[Q]),b.useEffect((()=>{qe&&we(!1)}),[te]),u.useVerticalArrows(ae,qe);const Ge=s.jsx("input",{id:X,ref:fe,disabled:_,role:"combobox","aria-controls":U,"aria-expanded":qe,value:Z?Q:te||"",placeholder:L,className:ce,readOnly:!H,onBlur:()=>ee(!1),onChange:e=>{ee(!0),Y(e.target.value),G&&G(e.target.value),qe||we(!0)},type:"text"}),We="solid"===A?"slate":"gray",Le=()=>{if(!me.current)return;const e=me.current.scrollHeight>(I||0);le(x.list({size:M,open:qe,mode:k,radius:F,shadow:V,overflown:e}))};return b.useEffect((()=>{var e,s;if(!(null===(e=be.current)||void 0===e?void 0:e.dataset))return;const o=Object.assign({},null===(s=be.current)||void 0===s?void 0:s.dataset),t=o.hasOwnProperty("hasLeftElement"),r=o.hasOwnProperty("hasRightElement");ue(x.base({className:v,color:q,disabled:_,hasLeftElement:t,hasLeftIcon:J,hasRightElement:r,hasRightIcon:true,radius:F,shadow:V,size:M,tone:A,validation:$,withRing:D}))}),[v,q,_,J,true,F,V,M,x,A,$,D]),s.jsxs("div",Object.assign({id:T,ref:Ee,className:Se,onClick:()=>{qe||_||we(!0)}},K,{children:[N&&s.jsx("span",Object.assign({className:ke},{children:b.cloneElement(N,{className:Re})})),Ge,S&&s.jsx("span",Object.assign({className:Pe},{children:s.jsx(i,{size:M,color:We})})),!S&&O&&se&&s.jsx("button",Object.assign({disabled:_,onClick:e=>{re(""),oe(null),Y(""),e.stopPropagation()},className:Pe},{children:s.jsx(d.XMarkIcon,{className:ze})})),!S&&(!O||!se)&&s.jsx("div",Object.assign({className:Pe},{children:s.jsx(f.CaretUpDown,{className:ze})})),s.jsx(m.ComboboxContextProvider,Object.assign({value:ge},{children:s.jsx(l.FloatingPortal,{children:s.jsxs("div",Object.assign({id:U,ref:Ne,className:ie,style:{display:qe?"block":"none",opacity:qe&&!_?1:0,maxHeight:`${I}px`,minWidth:`${R}px`,maxWidth:`${de}px`,position:Oe,top:je&&je>0&&je!==1/0?je:0,left:xe||0}},ye,{children:[0===(null==ae?void 0:ae.length)&&Z&&s.jsx("div",Object.assign({className:Ie},{children:"No results"})),C]}))})}))]}))}));x.displayName="Combobox";const j=Object.assign(x,{Group:o.ComboboxGroup,Option:t.ComboboxOption});module.exports=j;
