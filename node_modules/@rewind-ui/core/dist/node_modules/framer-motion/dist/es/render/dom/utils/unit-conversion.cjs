"use strict";var e=require("../../../animation/utils/is-keyframes-target.cjs"),t=require("../../../utils/errors.cjs"),r=require("../../html/utils/transform.cjs"),s=require("../value-types/dimensions.cjs"),n=require("../../../utils/is-browser.cjs"),a=require("../../../value/types/numbers/index.cjs"),i=require("../../../value/types/numbers/units.cjs");const o=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),l=e=>o.has(e),u=e=>e===a.number||e===i.px,p=(e,t)=>parseFloat(e.split(", ")[t]),m=(e,t)=>(r,{transform:s})=>{if("none"===s||!s)return 0;const n=s.match(/^matrix3d\((.+)\)$/);if(n)return p(n[1],t);{const t=s.match(/^matrix\((.+)\)$/);return t?p(t[1],e):0}},f=new Set(["x","y","z"]),c=r.transformPropOrder.filter((e=>!f.has(e)));const d={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:m(4,13),y:m(5,14)},h=(r,a,o={},p={})=>{a={...a},p={...p};const m=Object.keys(a).filter(l);let f=[],h=!1;const g=[];if(m.forEach((n=>{const l=r.getValue(n);if(!r.hasValue(n))return;let m=o[n],d=s.findDimensionValueType(m);const y=a[n];let x;if(e.isKeyframesTarget(y)){const e=y.length,r=null===y[0]?1:0;m=y[r],d=s.findDimensionValueType(m);for(let n=r;n<e&&null!==y[n];n++)x?t.invariant(s.findDimensionValueType(y[n])===x,"All keyframes must be of the same type"):(x=s.findDimensionValueType(y[n]),t.invariant(x===d||u(d)&&u(x),"Keyframes must be of the same dimension as the current value"))}else x=s.findDimensionValueType(y);if(d!==x)if(u(d)&&u(x)){const e=l.get();"string"==typeof e&&l.set(parseFloat(e)),"string"==typeof y?a[n]=parseFloat(y):Array.isArray(y)&&x===i.px&&(a[n]=y.map(parseFloat))}else(null==d?void 0:d.transform)&&(null==x?void 0:x.transform)&&(0===m||0===y)?0===m?l.set(x.transform(m)):a[n]=d.transform(y):(h||(f=function(e){const t=[];return c.forEach((r=>{const s=e.getValue(r);void 0!==s&&(t.push([r,s.get()]),s.set(r.startsWith("scale")?1:0))})),t.length&&e.render(),t}(r),h=!0),g.push(n),p[n]=void 0!==p[n]?p[n]:a[n],l.jump(y))})),g.length){const e=g.indexOf("height")>=0?window.pageYOffset:null,t=((e,t,r)=>{const s=t.measureViewportBox(),n=t.current,a=getComputedStyle(n),{display:i}=a,o={};"none"===i&&t.setStaticValue("display",e.display||"block"),r.forEach((e=>{o[e]=d[e](s,a)})),t.render();const l=t.measureViewportBox();return r.forEach((r=>{const s=t.getValue(r);s&&s.jump(o[r]),e[r]=d[r](l,a)})),e})(a,r,g);return f.length&&f.forEach((([e,t])=>{r.getValue(e).set(t)})),r.render(),n.isBrowser&&null!==e&&window.scrollTo({top:e}),{target:t,transitionEnd:p}}return{target:a,transitionEnd:p}};exports.positionalValues=d,exports.unitConversion=function(e,t,r,s){return(e=>Object.keys(e).some(l))(t)?h(e,t,r,s):{target:t,transitionEnd:s}};
