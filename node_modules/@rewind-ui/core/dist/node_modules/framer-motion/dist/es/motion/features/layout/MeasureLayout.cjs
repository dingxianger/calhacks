"use strict";var e=require("../../../frameloop/index.cjs"),o=require("react"),t=require("../../../components/AnimatePresence/use-presence.cjs"),r=require("../../../context/LayoutGroupContext.cjs"),s=require("../../../context/SwitchLayoutGroupContext.cjs"),i=require("../../../projection/node/state.cjs"),n=require("../../../projection/styles/scale-border-radius.cjs"),a=require("../../../projection/styles/scale-box-shadow.cjs"),u=require("../../../projection/styles/scale-correction.cjs");class c extends o.Component{componentDidMount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t,layoutId:r}=this.props,{projection:s}=e;u.addScaleCorrector(d),s&&(o.group&&o.group.add(s),t&&t.register&&r&&t.register(s),s.root.didUpdate(),s.addEventListener("animationComplete",(()=>{this.safeToRemove()})),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),i.globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(o){const{layoutDependency:t,visualElement:r,drag:s,isPresent:i}=this.props,n=r.projection;return n?(n.isPresent=i,s||o.layoutDependency!==t||void 0===t?n.willUpdate():this.safeToRemove(),o.isPresent!==i&&(i?n.promote():n.relegate()||e.frame.postRender((()=>{const e=n.getStack();e&&e.members.length||this.safeToRemove()}))),null):null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask((()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()})))}componentWillUnmount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:t}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(r),t&&t.deregister&&t.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}const d={borderRadius:{...n.correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:n.correctBorderRadius,borderTopRightRadius:n.correctBorderRadius,borderBottomLeftRadius:n.correctBorderRadius,borderBottomRightRadius:n.correctBorderRadius,boxShadow:a.correctBoxShadow};exports.MeasureLayout=function(e){const[i,n]=t.usePresence(),a=o.useContext(r.LayoutGroupContext);return o.createElement(c,{...e,layoutGroup:a,switchLayoutGroup:o.useContext(s.SwitchLayoutGroupContext),isPresent:i,safeToRemove:n})};
