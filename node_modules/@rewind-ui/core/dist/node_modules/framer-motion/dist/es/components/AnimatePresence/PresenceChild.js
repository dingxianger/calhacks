import*as e from"react";import{useId as t,useMemo as o}from"react";import{PresenceContext as r}from"../../context/PresenceContext.js";import{useConstant as s}from"../../utils/use-constant.js";import{PopChild as i}from"./PopChild.js";const n=({children:n,initial:m,isPresent:a,onExitComplete:f,custom:p,presenceAffectsLayout:u,mode:l})=>{const d=s(c),E=t(),P=o((()=>({id:E,initial:m,isPresent:a,custom:p,onExitComplete:e=>{d.set(e,!0);for(const e of d.values())if(!e)return;f&&f()},register:e=>(d.set(e,!1),()=>d.delete(e))})),u?void 0:[a]);return o((()=>{d.forEach(((e,t)=>d.set(t,!1)))}),[a]),e.useEffect((()=>{!a&&!d.size&&f&&f()}),[a]),"popLayout"===l&&(n=e.createElement(i,{isPresent:a},n)),e.createElement(r.Provider,{value:P},n)};function c(){return new Map}export{n as PresenceChild};
