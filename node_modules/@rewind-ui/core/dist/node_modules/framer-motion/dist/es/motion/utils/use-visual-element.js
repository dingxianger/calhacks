import{useContext as t,useRef as e,useInsertionEffect as o,useEffect as n}from"react";import{PresenceContext as r}from"../../context/PresenceContext.js";import{MotionContext as i}from"../../context/MotionContext/index.js";import{useIsomorphicLayoutEffect as a}from"../../utils/use-isomorphic-effect.js";import{LazyContext as m}from"../../context/LazyContext.js";import{MotionConfigContext as c}from"../../context/MotionConfigContext.js";function s(s,p,u,f){const{visualElement:d}=t(i),x=t(m),C=t(r),l=t(c).reducedMotion,j=e();f=f||x.renderer,!j.current&&f&&(j.current=f(s,{visualState:p,parent:d,props:u,presenceContext:C,blockInitialAnimation:!!C&&!1===C.initial,reducedMotionConfig:l}));const M=j.current;o((()=>{M&&M.update(u,C)})),a((()=>{M&&M.render()})),n((()=>{M&&M.updateFeatures()}));return(window.HandoffAppearAnimations?a:n)((()=>{M&&M.animationState&&M.animationState.animateChanges()})),M}export{s as useVisualElement};
