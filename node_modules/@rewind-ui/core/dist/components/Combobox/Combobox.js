'use client';
import{__rest as e}from"tslib";import{jsx as o,jsxs as t}from"react/jsx-runtime";import{ComboboxGroup as a}from"./ComboboxGroup/ComboboxGroup.js";import{ComboboxOption as r}from"./ComboboxOption/ComboboxOption.js";import{useCombobox as s}from"./use-combobox.hook.js";import{useFormControlContext as i}from"../FormControl/FormControl.context.js";import{useInputGroupContext as n}from"../InputGroup/InputGroup.context.js";import l from"../Spinner/Spinner.js";import{useMergeRefs as c,FloatingPortal as d}from"@floating-ui/react";import{useKeypress as m}from"../../hooks/use-keypress.js";import{useVerticalArrows as p}from"../../hooks/use-vertical-arrows.hook.js";import{XMarkIcon as u}from"../../icons/XMark.js";import{useComponentTheme as h}from"../../theme/theme.context.js";import{usePropId as b}from"../../utils/usePropId.js";import{forwardRef as f,useId as g,useState as j,useRef as v,useEffect as x,useLayoutEffect as O,cloneElement as C}from"react";import{ComboboxContextProvider as N}from"./Combobox.context.js";import{CaretUpDown as y}from"../../icons/CaretUpDown.js";const w={clearable:!0,closeOnEscape:!0,color:"dark",disabled:!1,loading:!1,maxHeight:250,minWidth:250,mode:"spacey",offset:5,optionColor:"gray",radius:"md",searchable:!0,shadow:"none",size:"md",tone:"light",validation:"none",withRing:!0},z=f(((a,r)=>{const f=h("Combobox"),z=Object.assign(Object.assign(Object.assign(Object.assign({},w),i()),n()),a),{children:k,className:I,clearable:S,closeOnEscape:E,color:R,controlId:W,initialValue:G,leftIcon:H,loading:L,maxHeight:P,minWidth:V,mode:F,offset:$,onChange:q,onSearch:A,optionColor:B,placeholder:D,radius:M,searchable:T,shadow:U,size:X,tone:J,validation:K,value:Q,withRing:Y}=z,Z=e(z,["children","className","clearable","closeOnEscape","color","controlId","initialValue","leftIcon","loading","maxHeight","minWidth","mode","offset","onChange","onSearch","optionColor","placeholder","radius","searchable","shadow","size","tone","validation","value","withRing"]),_=b(a.id),ee=g(),oe=b(W),te=a.disabled||L,ae=!!H,[re,se]=j(""),[ie,ne]=j(!1),[le,ce]=j(G),[de,me]=j(""),[pe,ue]=j([]),[he,be]=j(""),[fe,ge]=j(""),[je,ve]=j(null),xe=v(!0),Oe=v(null),Ce=v(null),Ne=v(null),ye={externalSearch:!!A,mode:F,optionColor:B,radius:M,search:re,selectedLabel:de,selectedValue:le,setSearch:se,setSelectedLabel:me,setSelectedValue:ce,size:X},{x:we,y:ze,reference:ke,floating:Ie,strategy:Se,getFloatingProps:Ee,open:Re,setOpen:We}=s({offset:$}),Ge=c([ke,Oe,r||null]),He=c([Ce,Ie]),Le=f.wrapper({disabled:te}),Pe=f.noResults({size:X}),Ve=H?f.icon({tone:J,size:X,className:H.props.className}):null,Fe=f.leftIconWrapper({size:X}),$e=f.icon({tone:J,size:X}),qe=f.rightIconWrapper({size:X});x((()=>{Oe.current&&ve(Oe.current.getBoundingClientRect().width)}),[]),x((()=>{se(""),ne(!1)}),[de]),x((()=>{q&&!xe.current&&q(le),xe.current=!1}),[le]),x((()=>{ce(Q)}),[Q]),x((()=>{var e;Re&&(null===(e=Ne.current)||void 0===e||e.focus()),De()}),[Re]),m("Escape",!0,(()=>{se(""),ne(!1),Re&&E&&We(!1)})),m("Enter",!0,(()=>{var e;if(!ie)return;const o=null===(e=Ce.current)||void 0===e?void 0:e.querySelector('button[aria-hidden="false"]:not([aria-disabled="true"])');o&&o.click()})),O((()=>{setTimeout((()=>{Ce.current&&ue(Array.from(Ce.current.querySelectorAll('button[aria-hidden="false"][aria-disabled="false"]')))}),1),De()}),[re]),x((()=>{Re&&We(!1)}),[de]),p(pe,Re);const Ae=o("input",{id:oe,ref:Ne,disabled:te,role:"combobox","aria-controls":ee,"aria-expanded":Re,value:ie?re:de||"",placeholder:D,className:fe,readOnly:!T,onBlur:()=>ne(!1),onChange:e=>{ne(!0),se(e.target.value),A&&A(e.target.value),Re||We(!0)},type:"text"}),Be="solid"===J?"slate":"gray",De=()=>{if(!Ce.current)return;const e=Ce.current.scrollHeight>(P||0);be(f.list({size:X,open:Re,mode:F,radius:M,shadow:U,overflown:e}))};return x((()=>{var e,o;if(!(null===(e=Oe.current)||void 0===e?void 0:e.dataset))return;const t=Object.assign({},null===(o=Oe.current)||void 0===o?void 0:o.dataset),a=t.hasOwnProperty("hasLeftElement"),r=t.hasOwnProperty("hasRightElement");ge(f.base({className:I,color:R,disabled:te,hasLeftElement:a,hasLeftIcon:ae,hasRightElement:r,hasRightIcon:true,radius:M,shadow:U,size:X,tone:J,validation:K,withRing:Y}))}),[I,R,te,ae,true,M,U,X,f,J,K,Y]),t("div",Object.assign({id:_,ref:Ge,className:Le,onClick:()=>{Re||te||We(!0)}},Z,{children:[H&&o("span",Object.assign({className:Fe},{children:C(H,{className:Ve})})),Ae,L&&o("span",Object.assign({className:qe},{children:o(l,{size:X,color:Be})})),!L&&S&&le&&o("button",Object.assign({disabled:te,onClick:e=>{me(""),ce(null),se(""),e.stopPropagation()},className:qe},{children:o(u,{className:$e})})),!L&&(!S||!le)&&o("div",Object.assign({className:qe},{children:o(y,{className:$e})})),o(N,Object.assign({value:ye},{children:o(d,{children:t("div",Object.assign({id:ee,ref:He,className:he,style:{display:Re?"block":"none",opacity:Re&&!te?1:0,maxHeight:`${P}px`,minWidth:`${V}px`,maxWidth:`${je}px`,position:Se,top:ze&&ze>0&&ze!==1/0?ze:0,left:we||0}},Ee,{children:[0===(null==pe?void 0:pe.length)&&ie&&o("div",Object.assign({className:Pe},{children:"No results"})),k]}))})}))]}))}));z.displayName="Combobox";const k=Object.assign(z,{Group:a,Option:r});export{k as default};
