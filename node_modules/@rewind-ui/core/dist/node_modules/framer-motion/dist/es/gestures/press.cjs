"use strict";var e=require("../events/event-info.cjs"),s=require("../events/add-dom-event.cjs"),t=require("../events/add-pointer-event.cjs"),n=require("../motion/features/Feature.cjs"),r=require("../utils/pipe.cjs"),i=require("./drag/utils/lock.cjs"),o=require("./utils/is-node-or-child.cjs"),a=require("../utils/noop.cjs"),c=require("../frameloop/index.cjs");function d(s,t){if(!t)return;const n=new PointerEvent("pointer"+s);t(n,e.extractEventInfo(n))}class h extends n.Feature{constructor(){super(...arguments),this.removeStartListeners=a.noop,this.removeEndListeners=a.noop,this.removeAccessibleListeners=a.noop,this.startPointerPress=(e,s)=>{if(this.removeEndListeners(),this.isPressing)return;const n=this.node.getProps(),i=t.addPointerEvent(window,"pointerup",((e,s)=>{if(!this.checkPressEnd())return;const{onTap:t,onTapCancel:n}=this.node.getProps();c.frame.update((()=>{o.isNodeOrChild(this.node.current,e.target)?t&&t(e,s):n&&n(e,s)}))}),{passive:!(n.onTap||n.onPointerUp)}),a=t.addPointerEvent(window,"pointercancel",((e,s)=>this.cancelPress(e,s)),{passive:!(n.onTapCancel||n.onPointerCancel)});this.removeEndListeners=r.pipe(i,a),this.startPress(e,s)},this.startAccessiblePress=()=>{const e=s.addDomEvent(this.node.current,"keydown",(e=>{if("Enter"!==e.key||this.isPressing)return;this.removeEndListeners(),this.removeEndListeners=s.addDomEvent(this.node.current,"keyup",(e=>{"Enter"===e.key&&this.checkPressEnd()&&d("up",((e,s)=>{const{onTap:t}=this.node.getProps();t&&c.frame.update((()=>t(e,s)))}))})),d("down",((e,s)=>{this.startPress(e,s)}))})),t=s.addDomEvent(this.node.current,"blur",(()=>{this.isPressing&&d("cancel",((e,s)=>this.cancelPress(e,s)))}));this.removeAccessibleListeners=r.pipe(e,t)}}startPress(e,s){this.isPressing=!0;const{onTapStart:t,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),t&&c.frame.update((()=>t(e,s)))}checkPressEnd(){this.removeEndListeners(),this.isPressing=!1;return this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!i.isDragActive()}cancelPress(e,s){if(!this.checkPressEnd())return;const{onTapCancel:t}=this.node.getProps();t&&c.frame.update((()=>t(e,s)))}mount(){const e=this.node.getProps(),n=t.addPointerEvent(this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),i=s.addDomEvent(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=r.pipe(n,i)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}exports.PressGesture=h;
